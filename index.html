<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FinTrend News</title>

  <link rel="icon" type="image/png" href="assets/img/favicon.png" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-KSK5YVPJBR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KSK5YVPJBR');
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <style>
    :root{
      --bg:#050816;
      --panel: rgba(15, 23, 42, 0.88);
      --panel2: rgba(2, 6, 23, 0.38);
      --text:#f9fafb;
      --muted:#9ca3af;
      --border: rgba(148, 163, 184, 0.28);
      --accent:#f4c15d;
      --accent2: rgba(244,193,93,0.12);
      --radius: 22px;
      --shadow: 0 18px 45px rgba(0,0,0,0.45);
      --max: 1150px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at top, rgba(17, 24, 39, 0.72) 0, rgba(2, 6, 23, 0.88) 45%, rgba(0,0,0,0.92) 100%),
        url("assets/img/bg-candles.png");
      background-size:cover;
      background-position:center;
      background-attachment:fixed;
      line-height:1.6;
    }

    a{color:inherit;text-decoration:none}
    a:hover{color:var(--accent)}

    .wrap{max-width:var(--max);margin:16px auto 70px;padding:0 16px}

    /* Sticky header */
    header{
      position:sticky;top:0;z-index:9999;
      border:1px solid rgba(148, 163, 184, 0.20);
      border-radius: var(--radius);
      overflow:hidden;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.84));
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      margin-bottom:14px;
    }

    .ticker{
      border-bottom:1px solid rgba(148, 163, 184, 0.22);
      background: radial-gradient(circle at top, #020617 0, #000 65%);
      padding:6px 16px;
    }

    .headerRow{
      display:grid;
      grid-template-columns:auto 1fr auto;
      gap:14px;
      align-items:center;
      padding:14px 18px;
    }

    .logo{height:50px;width:auto;display:block}

    .brand{
      text-align:center;
    }
    .brand h1{
      font-family:"Playfair Display",serif;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:30px;
      line-height:1.05;
      color:var(--accent);
    }
    .brand p{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.14em;
      text-transform:uppercase;
    }

    .nav{
      display:flex;gap:14px;flex-wrap:wrap;justify-content:flex-end;align-items:center;
    }

    .navLink{
      font-size:12px;color:var(--muted);
      letter-spacing:.10em;text-transform:uppercase;
      cursor:pointer;
    }

    .btn{
      border:0;
      cursor:pointer;
      border-radius:999px;
      padding:9px 14px;
      font-size:12px;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-weight:900;
      transition: .18s ease;
    }
    .btnPrimary{background:var(--accent);color:#000;box-shadow: 0 12px 28px rgba(244,193,93,0.16);}
    .btnPrimary:hover{background:#f7d680;transform:translateY(-1px)}
    .btnPrimary:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
    .btnGhost{
      background: rgba(2,6,23,0.35);
      border:1px solid rgba(148, 163, 184, 0.30);
      color: var(--text);
      font-weight:800;
    }
    .btnGhost:hover{border-color:rgba(244,193,93,0.38);transform:translateY(-1px)}

    .chip{
      display:none;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.28);
      background:rgba(2,6,23,0.35);
      color:var(--muted);
      max-width:280px;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
      font-size:12px;
    }
    .chipDot{width:7px;height:7px;border-radius:999px;background:rgba(148,163,184,0.5);box-shadow:0 0 0 4px rgba(148,163,184,0.12)}
    .chip.premium .chipDot{background:rgba(147,197,253,0.95);box-shadow:0 0 0 4px rgba(147,197,253,0.12)}

    @media (max-width:850px){
      .headerRow{grid-template-columns:1fr;justify-items:start}
      .brand{text-align:left}
      .nav{justify-content:flex-start}
    }

    /* Panels */
    .panel{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      margin-top:16px;
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(6px);
    }
    .panel::before{
      content:"";
      position:absolute;
      inset:-35%;
      background: radial-gradient(circle at top left, rgba(244,193,93,0.10), transparent 55%);
      pointer-events:none;
      opacity:.85;
    }

    .panelHead{
      position:relative;z-index:1;
      display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap;
      margin-bottom:12px;
    }
    .kicker{
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.16em;
      font-size:12px;
    }
    .subk{
      color:var(--muted);
      font-size:12px;
    }

    /* HERO */
    .heroGrid{
      position:relative;z-index:1;
      display:grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width:920px){
      .heroGrid{grid-template-columns:1fr}
    }

    .heroCopy h2{
      font-family:"Playfair Display",serif;
      font-size:42px;
      line-height:1.08;
      margin-bottom:10px;
    }
    .heroCopy h2 span{
      background:linear-gradient(135deg,#fef3c7,#fbbf24,#fb923c);
      -webkit-background-clip:text;
      color:transparent;
    }
    .heroCopy p{
      color:#e5e7eb;
      font-size:15px;
      max-width:62ch;
      margin-bottom:12px;
    }

    .heroActions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:10px;
    }

    .reassure{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    /* Right column cards */
    .rightStack{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* Premium spinning orb card */
    .premiumSpin{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      padding:14px;
      position:relative;
      overflow:hidden;
      min-height:150px;
    }
    .premiumSpin::before{
      content:"";
      position:absolute;
      inset:-55%;
      background: radial-gradient(circle at 30% 20%, rgba(147,197,253,0.16), transparent 55%),
                  radial-gradient(circle at 70% 60%, rgba(244,193,93,0.12), transparent 55%);
      pointer-events:none;
      opacity:.95;
    }
    .orb{
      position:absolute;
      right:-26px;
      top:-26px;
      width:180px;
      height:180px;
      border-radius:999px;
      border:1px solid rgba(147,197,253,0.28);
      background:
        radial-gradient(circle at 35% 35%, rgba(147,197,253,0.35), rgba(2,6,23,0.0) 55%),
        radial-gradient(circle at 70% 70%, rgba(244,193,93,0.18), rgba(2,6,23,0.0) 55%);
      box-shadow:
        inset 0 0 0 10px rgba(147,197,253,0.06),
        0 18px 50px rgba(0,0,0,0.35);
      animation: orbspin 12s linear infinite;
      pointer-events:none;
      opacity:.95;
    }
    .orb::after{
      content:"";
      position:absolute;
      inset:18px;
      border-radius:999px;
      border:1px dashed rgba(244,193,93,0.28);
      animation: orbspin 8s linear infinite reverse;
      opacity:.9;
    }
    @keyframes orbspin { from{transform:rotate(0)} to{transform:rotate(360deg)} }

    .premiumInner{
      position:relative;
      z-index:1;
    }
    .premiumTitle{
      font-family:"Playfair Display",serif;
      font-size:22px;
      line-height:1.15;
      margin:6px 0 6px;
    }
    .premiumText{
      font-size:13px;
      color:#d1d5db;
      max-width:52ch;
      margin-bottom:10px;
    }

    /* Market chart card */
    .rotCard{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      padding:12px;
      position:relative;
      overflow:hidden;
    }
    .rotTop{
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;
      margin-bottom:10px;
    }
    .rotTitle{
      font-size:12px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--muted);
    }
    .rotNow{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--accent);
    }
    .rotRing{
      position:absolute;
      top:-40px; right:-40px;
      width:140px;height:140px;border-radius:999px;
      border:1px solid rgba(244,193,93,0.28);
      box-shadow: inset 0 0 0 10px rgba(244,193,93,0.06);
      animation: spin 10s linear infinite;
      pointer-events:none;
      opacity:.8;
    }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }

    /* Week interactive */
    .weekGrid{
      position:relative;z-index:1;
      display:grid;
      grid-template-columns: 0.95fr 1.05fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width:980px){.weekGrid{grid-template-columns:1fr}}

    .weekLeft{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      padding:16px;
    }
    .weekLeft h3{
      font-family:"Playfair Display",serif;
      font-size:24px;
      line-height:1.15;
      margin:6px 0 8px;
    }
    .weekLeft p{color:#d1d5db;font-size:13px;max-width:60ch}

    .dayPills{
      display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;
    }
    .pill{
      border:1px solid rgba(148,163,184,0.28);
      background: rgba(2,6,23,0.30);
      color:var(--muted);
      border-radius:999px;
      padding:8px 12px;
      cursor:pointer;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      transition:.18s ease;
      user-select:none;
    }
    .pill:hover{transform:translateY(-1px);border-color:rgba(244,193,93,0.35)}
    .pill.active{
      border-color: rgba(244,193,93,0.55);
      background: rgba(244,193,93,0.10);
      color: var(--accent);
      box-shadow: 0 0 0 4px rgba(244,193,93,0.08);
    }

    .weekRight{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      padding:16px;
      overflow:hidden;
      position:relative;
    }
    .weekRight::before{
      content:"";
      position:absolute;inset:-40%;
      background: radial-gradient(circle at top right, rgba(244,193,93,0.12), transparent 55%);
      pointer-events:none;
      opacity:.8;
    }
    .weekCard{
      position:relative;z-index:1;
      border-radius:16px;
      border:1px solid rgba(148,163,184,0.20);
      background: rgba(15,23,42,0.62);
      padding:14px;
    }
    .weekCardTop{
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:baseline;
      margin-bottom:8px;
    }
    .weekLabel{
      font-weight:900;color:#e5e7eb;font-size:18px;line-height:1.2;
    }
    .weekMeta{
      font-size:11px;color:var(--muted);
      letter-spacing:.14em;text-transform:uppercase;
      border:1px solid rgba(148,163,184,0.26);
      background: rgba(2,6,23,0.30);
      padding:4px 8px;border-radius:999px;
    }
    .weekDesc{color:#d1d5db;font-size:13px;margin-bottom:10px}
    .weekBullets{padding-left:16px;color:#e5e7eb;font-size:12px}
    .weekBullets li{margin-bottom:6px}

    /* Charts under week */
    .chartRow{
      position:relative;z-index:1;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px;
    }
    .watchBtn{
      border:1px solid rgba(148,163,184,0.30);
      background: rgba(2,6,23,0.35);
      color: var(--text);
      border-radius: 999px;
      padding:8px 12px;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      cursor:pointer;
      transition:.18s ease;
    }
    .watchBtn:hover{transform:translateY(-1px);border-color:rgba(244,193,93,0.35)}
    .watchBtn.active{border-color: rgba(244,193,93,0.55); background: rgba(244,193,93,0.10); color: var(--accent)}

    .chartBox{
      margin-top:10px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.25);
      border-radius: 18px;
      padding:10px;
      overflow:hidden;
    }

    /* Deep dive section */
    .grid2{
      position:relative;z-index:1;
      display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;
    }
    @media (max-width:900px){.grid2{grid-template-columns:1fr}}
    .card{
      border-radius:18px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      padding:16px;
      transition:.18s ease;
    }
    .card:hover{transform:translateY(-2px);border-color:rgba(244,193,93,0.35)}
    .cardTag{font-size:11px;color:var(--muted);letter-spacing:.16em;text-transform:uppercase;margin-bottom:8px}
    .cardTitle{font-size:16px;font-weight:900;line-height:1.25;margin-bottom:8px;color:#e5e7eb}
    .cardText{font-size:12px;color:var(--muted)}
    .cardText ul{margin-top:8px;padding-left:16px;color:#e5e7eb}
    .cardText li{margin-bottom:6px}

    footer{
      margin-top:22px;
      text-align:center;
      color: var(--muted);
      font-size:11px;
    }

    /* Modals */
    .modalBackdrop{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,0.62);
      z-index:100000;
      padding:14px;
    }
    .modalBackdrop.active{display:flex}
    .modal{
      width:100%;
      max-width:460px;
      border-radius:24px;
      border:1px solid rgba(148,163,184,0.35);
      background: rgba(15, 23, 42, 0.97);
      box-shadow: var(--shadow);
      padding:22px 22px 18px;
      position:relative;
    }
    .modalClose{
      position:absolute; top:10px; right:12px;
      border:0;background:transparent;color:var(--muted);
      font-size:22px;cursor:pointer;
    }
    .modalK{font-size:11px;color:var(--muted);letter-spacing:.18em;text-transform:uppercase;margin-bottom:4px}
    .modalH{font-family:"Playfair Display",serif;font-size:22px;margin-bottom:6px}
    .modalP{font-size:13px;color:#d1d5db;margin-bottom:12px}
    .in{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(148,163,184,0.4);
      background:#020617;
      color:var(--text);
      font-size:12px;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .msg{margin-top:10px;font-size:12px;color:#e5e7eb}

    /* Example briefing card */
    .sampleBrief{
      margin-top:14px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.35);
      border-radius:18px;
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .sampleBrief::before{
      content:"";
      position:absolute;
      inset:-45%;
      background: radial-gradient(circle at top right, rgba(244,193,93,0.10), transparent 55%);
      pointer-events:none;
      opacity:.9;
    }
    .sampleBriefInner{position:relative;z-index:1}
    .sampleBriefLabel{
      font-size:11px;
      color:var(--muted);
      letter-spacing:.16em;
      text-transform:uppercase;
      margin-bottom:10px;
    }
    .sampleBriefRow{
      display:flex;
      gap:12px;
      align-items:flex-start;
      margin-bottom:10px;
    }
    .sampleBriefTag{
      font-size:11px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:var(--muted);
      min-width:92px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.22);
      background: rgba(2,6,23,0.25);
      line-height:1.2;
      margin-top:1px;
      white-space:nowrap;
    }
    .sampleBriefText{
      font-size:13px;
      color:#e5e7eb;
      line-height:1.45;
    }
    .sampleBriefFoot{
      font-size:11px;
      color:var(--muted);
      margin-top:8px;
      opacity:.85;
    }
    @media (max-width:520px){
      .sampleBriefRow{flex-direction:column;gap:6px}
      .sampleBriefTag{min-width:auto;align-self:flex-start}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <!-- TradingView ticker tape -->
      <div class="ticker">
        <div class="tradingview-widget-container">
          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
{
  "symbols": [
    { "proName": "FOREXCOM:SPXUSD", "title": "S&P 500" },
    { "proName": "NASDAQ:NDX", "title": "Nasdaq 100" },
    { "proName": "DJI", "title": "Dow 30" },
    { "proName": "RUSSELL:RTY", "title": "Russell 2000" },
    { "proName": "OANDA:EURUSD", "title": "EURUSD" },
    { "proName": "COINBASE:BTCUSD", "title": "BTCUSD" },
    { "proName": "OANDA:WTICOUSD", "title": "WTI Crude" },
    { "proName": "OANDA:XAUUSD", "title": "Gold" }
  ],
  "colorTheme": "dark",
  "isTransparent": true,
  "displayMode": "adaptive",
  "locale": "en"
}
          </script>
        </div>
      </div>

      <div class="headerRow">
        <img src="assets/img/FTN-logo.png" class="logo" alt="FinTrend News logo" />

        <div class="brand">
          <h1>FinTrend News</h1>
          <p>Market briefing, not noise</p>
        </div>

        <div class="nav">
          <a class="navLink" href="archive.html">Archive</a>
          <a class="navLink" href="#week">Week Map</a>
          <a class="navLink" href="#deepdive">Deep Dives</a>

          <!-- FIX: sign-in/out visibility controlled entirely by JS -->
          <a class="navLink" href="#" id="open-auth" style="display:none;">Sign In</a>
          <a class="navLink" href="#" id="signout" style="display:none;">Sign Out</a>

          <div class="chip" id="chip">
            <span class="chipDot"></span>
            <span id="chipText">Signed in</span>
          </div>

          <button class="btn btnPrimary" id="cta-create">Create Free Account</button>
        </div>
      </div>
    </header>

    <!-- HERO -->
    <section class="panel" id="top">
      <!-- FIX: removed dev note panelHead -->

      <div class="heroGrid">
        <!-- Left copy -->
        <div class="heroCopy">
          <h2>A <span>market brief</span> built for fast decisions.</h2>
          <p>
            Clear drivers → implications → levels. No long story. Just what matters and what changes the view.
          </p>

          <!-- FIX: single primary CTA, archive is secondary text link only -->
          <div class="heroActions">
            <button class="btn btnPrimary" id="cta-create-2">Create Free Account</button>
          </div>
          <div style="margin-top:10px;">
            <a href="archive.html" style="font-size:12px;color:var(--muted);letter-spacing:.10em;text-transform:uppercase;">or browse free articles →</a>
          </div>

          <!-- Example briefing format — strongest selling point, make it prominent -->
          <div class="sampleBrief" aria-label="Example Briefing Format">
            <div class="sampleBriefInner">
              <div class="sampleBriefLabel">Example Briefing Format</div>

              <div class="sampleBriefRow">
                <div class="sampleBriefTag">Driver</div>
                <div class="sampleBriefText">Inflation surprise shifts rate expectations.</div>
              </div>

              <div class="sampleBriefRow">
                <div class="sampleBriefTag">Bias</div>
                <div class="sampleBriefText">Short-term risk-off while yields stabilize.</div>
              </div>

              <div class="sampleBriefRow">
                <div class="sampleBriefTag">Key Levels</div>
                <div class="sampleBriefText">Support / resistance zones to monitor.</div>
              </div>

              <div class="sampleBriefRow" style="margin-bottom:0;">
                <div class="sampleBriefTag">Catalyst</div>
                <div class="sampleBriefText">Upcoming central bank commentary.</div>
              </div>

              <div class="sampleBriefFoot">*Illustrative example. Educational content only.</div>
            </div>
          </div>

          <div class="reassure">No credit card • Email used for login</div>
        </div>

        <!-- Right: Premium spin + market chart -->
        <div class="rightStack">
          <div class="premiumSpin">
            <div class="orb"></div>
            <div class="premiumInner">
              <div class="kicker">Premium</div>
              <div class="premiumTitle">Premium Deep Dives</div>
              <div class="premiumText">
                Long-form sector reports: drivers, positioning, catalysts, and levels — built like a playbook.
              </div>
              <div class="row">
                <button class="btn btnPrimary" id="goPremiumTop">View Premium</button>
                <a class="btn btnGhost" href="#deepdive">What is a Deep Dive?</a>
              </div>
              <div class="reassure" id="premiumStatusTop" style="display:none;"></div>
            </div>
          </div>

          <div class="rotCard">
            <div class="rotRing"></div>
            <div class="rotTop">
              <div class="rotTitle">Market chart</div>
              <div class="rotNow" id="rotNow">SPX</div>
            </div>

            <div class="chartRow" style="margin-top:0;">
              <button class="watchBtn active" data-rot="FOREXCOM:SPXUSD" data-label="SPX">SPX</button>
              <button class="watchBtn" data-rot="OANDA:EURUSD" data-label="EURUSD">EURUSD</button>
              <button class="watchBtn" data-rot="COINBASE:BTCUSD" data-label="BTC">BTC</button>
              <button class="watchBtn" data-rot="OANDA:XAUUSD" data-label="Gold">Gold</button>
            </div>

            <div class="chartBox">
              <div id="rotChart"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WEEK MAP -->
    <section class="panel" id="week">
      <div class="panelHead">
        <div>
          <div class="kicker">Week Map</div>
          <div class="subk">Same framework. Different job. Every time.</div>
        </div>
      </div>

      <div class="weekGrid">
        <div class="weekLeft">
          <!-- FIX: removed self-narrating copy, replaced with clean product copy -->
          <h3>4 formats. One consistent framework.</h3>
          <p>
            Monday sets the bias. Wednesday checks the momentum. Friday recaps what actually changed. Sunday maps the week ahead. Pick a day to see what you get.
          </p>

          <div class="dayPills">
            <button class="pill active" data-day="mon">Mon</button>
            <button class="pill" data-day="wed">Wed</button>
            <button class="pill" data-day="fri">Fri</button>
            <button class="pill" data-day="sun">Sun</button>
          </div>

          <!-- FIX: single primary CTA here too -->
          <div class="heroActions" style="margin-top:14px;">
            <button class="btn btnPrimary" id="cta-create-3">Create Free Account</button>
          </div>
          <div style="margin-top:10px;">
            <a href="archive.html" style="font-size:12px;color:var(--muted);letter-spacing:.10em;text-transform:uppercase;">or browse free articles →</a>
          </div>

          <div class="reassure">No credit card • Email used for login</div>
        </div>

        <div class="weekRight">
          <div class="weekCard" id="weekCard"></div>

          <div style="margin-top:14px;position:relative;z-index:1;">
            <div class="kicker">Live Charts</div>

            <div class="chartRow">
              <button class="watchBtn active" data-symbol="FOREXCOM:SPXUSD">SPX</button>
              <button class="watchBtn" data-symbol="NASDAQ:NDX">NDX</button>
              <button class="watchBtn" data-symbol="OANDA:EURUSD">EURUSD</button>
              <button class="watchBtn" data-symbol="COINBASE:BTCUSD">BTC</button>
              <button class="watchBtn" data-symbol="OANDA:XAUUSD">Gold</button>
            </div>

            <div class="chartBox">
              <div id="watchChart"></div>
              <!-- FIX: fallback only shows if chart truly fails — handled in JS with load detection -->
              <div id="watchFallback" class="reassure" style="display:none;margin-top:10px;">
                Chart unavailable. <a id="watchOpenTV" href="#" target="_blank" rel="noopener">Open on TradingView ↗</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Deep Dive section -->
    <section class="panel" id="deepdive">
      <div class="panelHead">
        <div>
          <div class="kicker">Deep Dives</div>
          <div class="subk">One sector. One theme. Fully mapped.</div>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="cardTag">What it is</div>
          <div class="cardTitle">Not news. A playbook.</div>
          <div class="cardText">
            Each Deep Dive takes one sector or trending theme and breaks it down completely:
            <ul>
              <li><strong>Driver:</strong> what's actually moving it</li>
              <li><strong>Winners/Losers:</strong> who benefits + who gets hurt</li>
              <li><strong>Catalysts:</strong> what events change the story</li>
              <li><strong>Levels:</strong> the "if this breaks, we're wrong" points</li>
            </ul>
          </div>
        </div>

        <!-- FIX: removed internal "unchanged logic" tag and self-narrating copy -->
        <div class="card">
          <div class="cardTag">Premium</div>
          <div class="cardTitle">Unlock Deep Dives</div>
          <div class="cardText">
            Premium members get access to every Deep Dive and the full members dashboard.
            <div class="row" style="margin-top:12px;">
              <button class="btn btnPrimary" id="goPremium">View Premium</button>
              <a class="btn btnGhost" href="archive.html">Browse Free</a>
            </div>
            <div class="reassure" id="premiumStatus" style="margin-top:10px;display:none;"></div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <p style="max-width:760px;margin:0 auto 8px;">
        <strong>Disclaimer:</strong> Informational + educational only. Not financial advice.
      </p>
      <p>© 2026 FinTrend News · <a href="archive.html">Archive</a></p>
    </footer>
  </div>

  <!-- AUTH MODAL -->
  <div class="modalBackdrop" id="authModal">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="modalClose" id="closeAuth">×</button>
      <div class="modalK">FinTrend Account</div>
      <div class="modalH" id="authTitle">Create Free Account</div>
      <div class="modalP" id="authSubtitle">Create an account to unlock account-gated reads. No credit card.</div>

      <form id="authForm">
        <input class="in" id="email" type="email" placeholder="Email" required />
        <div style="height:10px"></div>
        <input class="in" id="password" type="password" placeholder="Password" required />

        <div class="row">
          <button class="btn btnPrimary" type="submit" id="authSubmit">Create Free Account</button>
          <button class="btn btnGhost" type="button" id="toggleMode">Already have an account?</button>
        </div>
        <div class="msg" id="authMsg"></div>
      </form>
    </div>
  </div>

  <!-- PREMIUM MODAL -->
  <div class="modalBackdrop" id="premiumModal">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="modalClose" id="closePremium">×</button>
      <div class="modalK">FinTrend Premium</div>
      <div class="modalH">Upgrade to Premium</div>
      <div class="modalP">Unlock Deep Dives and the full members dashboard.</div>

      <div class="row">
        <a class="btn btnPrimary" href="#" id="payLink">Go Premium</a>
        <button class="btn btnGhost" id="closePremium2" type="button">Not now</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      "use strict";

      const PAYMENT_LINK = "https://buy.stripe.com/aFabJ0auNdEVbnR4m2ffy00";
      const PREMIUM_DASHBOARD = "premium.html";
      const FREE_ACCOUNT_PAGE = "archive.html";

      const authModal = document.getElementById("authModal");
      const premiumModal = document.getElementById("premiumModal");

      function openModal(m){ m.classList.add("active"); }
      function closeModal(m){ m.classList.remove("active"); }

      const authTitle = document.getElementById("authTitle");
      const authSubtitle = document.getElementById("authSubtitle");
      const authSubmit = document.getElementById("authSubmit");
      const toggleModeBtn = document.getElementById("toggleMode");
      const authMsg = document.getElementById("authMsg");

      const chip = document.getElementById("chip");
      const chipText = document.getElementById("chipText");
      const signout = document.getElementById("signout");
      const openAuth = document.getElementById("open-auth");
      const ctaCreate = document.getElementById("cta-create");

      // Close buttons
      document.getElementById("closeAuth").addEventListener("click",()=>closeModal(authModal));
      authModal.addEventListener("click",(e)=>{ if(e.target===authModal) closeModal(authModal); });

      document.getElementById("closePremium").addEventListener("click",()=>closeModal(premiumModal));
      document.getElementById("closePremium2").addEventListener("click",()=>closeModal(premiumModal));
      premiumModal.addEventListener("click",(e)=>{ if(e.target===premiumModal) closeModal(premiumModal); });

      // Mode switching
      let mode = "signup";
      function setMode(m){
        mode = m;
        if(authMsg) authMsg.textContent = "";
        if(authSubmit) authSubmit.disabled = false;

        if(mode === "signup"){
          authTitle.textContent = "Create Free Account";
          authSubtitle.textContent = "Create an account to unlock account-gated reads. No credit card.";
          authSubmit.textContent = "Create Free Account";
          toggleModeBtn.textContent = "Already have an account?";
        } else {
          authTitle.textContent = "Sign in";
          authSubtitle.textContent = "Sign in to continue reading and access your account.";
          authSubmit.textContent = "Sign in";
          toggleModeBtn.textContent = "Create Free Account";
        }
      }
      toggleModeBtn.addEventListener("click",()=>setMode(mode==="signup"?"signin":"signup"));

      openAuth.addEventListener("click",(e)=>{
        e.preventDefault();
        setMode("signin");
        openModal(authModal);
      });

      [ "cta-create","cta-create-2","cta-create-3" ].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.addEventListener("click",()=>{ setMode("signup"); openModal(authModal); });
      });

      function humanErr(err){
        const raw = (err && err.message) ? String(err.message) : String(err || "");
        const msg = raw.toLowerCase();
        if (msg.includes("invalid login") || msg.includes("credentials")) return "Wrong email or password.";
        if (msg.includes("email not confirmed")) return "Confirm your email, then sign in.";
        if (msg.includes("rate limit") || msg.includes("too many")) return "Too many attempts. Try again in a minute.";
        return raw || "Something went wrong. Try again.";
      }

      // Week map
      const weekData = {
        mon: { title:"Monday · Outlook", meta:"Set the week's bias", desc:"Start with the driver. End with one level that changes your mind.", bullets:["Primary driver (rates / USD / credit / oil)","Base case + 1 alternative scenario","Key level + invalidation"] },
        wed: { title:"Wednesday · Momentum", meta:"Mid-week reality check", desc:"What's working, what's fading, and whether the move is healthy or crowded.", bullets:["Leadership + rotation snapshot","Crowding/stretch note (risk/reward)","What must happen next for the trend to continue"] },
        fri: { title:"Friday · Recap", meta:"What changed (for real)", desc:"Did the driver change? Or just the story? You get the clean answer.", bullets:["What changed: driver vs narrative vs positioning","Winners/losers (with why)","Levels that matter into next week"] },
        sun: { title:"Sunday · Macro Setup", meta:"The map into next week", desc:"What's priced in, what could surprise, and the one catalyst that matters most.", bullets:["Priced-in vs surprise framing","2–3 scenarios max","Catalyst calendar + watch points"] }
      };

      const weekCard = document.getElementById("weekCard");
      function renderDay(key){
        const d = weekData[key];
        weekCard.innerHTML = `
          <div class="weekCardTop">
            <div class="weekLabel">${d.title}</div>
            <div class="weekMeta">${d.meta}</div>
          </div>
          <div class="weekDesc">${d.desc}</div>
          <ul class="weekBullets">${d.bullets.map(b=>`<li>${b}</li>`).join("")}</ul>
        `;
      }
      renderDay("mon");
      document.querySelectorAll(".pill").forEach(p=>{
        p.addEventListener("click",()=>{
          document.querySelectorAll(".pill").forEach(x=>x.classList.remove("active"));
          p.classList.add("active");
          renderDay(p.dataset.day);
        });
      });

      // TradingView
      function loadMiniSymbolOverview(targetId, symbol, height){
        const el = document.getElementById(targetId);
        if(!el) return;
        el.innerHTML = "";
        const s = document.createElement("script");
        s.src = "https://s3.tradingview.com/external-embedding/embed-widget-mini-symbol-overview.js";
        s.async = true;
        s.text = JSON.stringify({
          symbol,
          width: "100%",
          height: height || 280,
          locale: "en",
          dateRange: "3M",
          colorTheme: "dark",
          isTransparent: true,
          autosize: true
        });
        el.appendChild(s);
      }

      const rotNow = document.getElementById("rotNow");
      function loadRot(symbol, label){
        if(rotNow) rotNow.textContent = label || "";
        loadMiniSymbolOverview("rotChart", symbol, 260);
      }
      loadRot("FOREXCOM:SPXUSD", "SPX");
      document.querySelectorAll("[data-rot]").forEach(btn=>{
        btn.addEventListener("click",()=>{
          const parentRow = btn.closest(".chartRow");
          if(parentRow){
            parentRow.querySelectorAll(".watchBtn").forEach(b=>b.classList.remove("active"));
          }
          btn.classList.add("active");
          loadRot(btn.getAttribute("data-rot"), btn.getAttribute("data-label"));
        });
      });

      // FIX: chart fallback — only show if TradingView iframe fails to load after a longer window
      // Instead of always showing after 2.5s, we check if an iframe actually appeared
      const watchFallback = document.getElementById("watchFallback");
      const watchOpenTV = document.getElementById("watchOpenTV");
      let watchFallbackTimer = null;

      function showFallback(symbol){
        if(!watchFallback) return;
        watchFallback.style.display = "block";
        if(watchOpenTV) watchOpenTV.href = "https://www.tradingview.com/chart/?symbol=" + encodeURIComponent(symbol);
      }
      function hideFallback(){
        if(watchFallbackTimer) clearTimeout(watchFallbackTimer);
        watchFallbackTimer = null;
        if(!watchFallback) return;
        watchFallback.style.display = "none";
      }
      function loadWatch(symbol){
        hideFallback();
        loadMiniSymbolOverview("watchChart", symbol, 300);
        // Only show fallback if no iframe appears after 5 seconds
        watchFallbackTimer = setTimeout(()=>{
          const el = document.getElementById("watchChart");
          const hasIframe = el && el.querySelector("iframe");
          if(!hasIframe) showFallback(symbol);
        }, 5000);
      }
      loadWatch("FOREXCOM:SPXUSD");
      document.querySelectorAll(".watchBtn").forEach(btn=>{
        if(btn.hasAttribute("data-symbol")){
          btn.addEventListener("click",()=>{
            document.querySelectorAll(".watchBtn").forEach(b=>{
              if(b.hasAttribute("data-symbol")) b.classList.remove("active");
            });
            btn.classList.add("active");
            loadWatch(btn.dataset.symbol);
          });
        }
      });

      // Supabase
      const SUPABASE_URL = "https://dxmdyperxyydqdshazcp.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4bWR5cGVyeHl5ZHFkc2hhemNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5NjMyNDQsImV4cCI6MjA4NDUzOTI0NH0.nMKF2wi8FWX0eYrDzSyJE_CPl8XgSMx27fPlcZ9gVzI";

      let supabase = null;

      // FIX: proper signed-out state — show Sign In button, hide chip and sign out
      function setSignedOutUI(){
        chip.style.display = "none";
        openAuth.style.display = "";
        signout.style.display = "none";
        if(ctaCreate) ctaCreate.style.display = "";

        // Hide premium status text
        const ps = document.getElementById("premiumStatus");
        const psTop = document.getElementById("premiumStatusTop");
        if(ps) ps.style.display = "none";
        if(psTop) psTop.style.display = "none";
      }

      // FIX: signed-in state — hide Sign In and Create Account button, show chip + sign out
      function setSignedInUI(email, isPremium){
        chip.style.display = "inline-flex";
        chip.classList.toggle("premium", !!isPremium);
        chipText.textContent = (isPremium ? "Premium · " : "Free · ") + email;
        openAuth.style.display = "none";
        signout.style.display = "";
        if(ctaCreate) ctaCreate.style.display = "none";

        // Show premium status
        const ps = document.getElementById("premiumStatus");
        const psTop = document.getElementById("premiumStatusTop");
        if(ps){ ps.style.display = ""; ps.textContent = isPremium ? "You have premium access." : "Free account active."; }
        if(psTop){ psTop.style.display = ""; psTop.textContent = isPremium ? "You have premium access." : "Upgrade for full access."; }
      }

      async function fetchPremiumStatus(userId){
        const { data, error } = await supabase
          .from("profiles")
          .select("is_premium, premium_until")
          .eq("id", userId)
          .single();

        if (error || !data) return false;
        if (data.premium_until) {
          const until = new Date(data.premium_until);
          if (until < new Date()) return false;
        }
        return !!data.is_premium;
      }

      document.getElementById("payLink").addEventListener("click",(e)=>{
        e.preventDefault();
        window.open(PAYMENT_LINK,"_blank");
      });

      document.getElementById("goPremium").addEventListener("click",(e)=>{ e.preventDefault(); window.location.href = PREMIUM_DASHBOARD; });
      document.getElementById("goPremiumTop").addEventListener("click",(e)=>{ e.preventDefault(); window.location.href = PREMIUM_DASHBOARD; });

      // Init — wait for Supabase to load
      let attempts = 0;
      const check = setInterval(() => {
        attempts++;

        if (window.supabase && window.supabase.createClient) {
          clearInterval(check);

          supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

          document.getElementById("authForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            authMsg.textContent = "";
            const emailVal = document.getElementById("email").value.trim();
            const passwordVal = document.getElementById("password").value;

            if (!emailVal || !passwordVal) {
              authMsg.textContent = "Enter email + password.";
              return;
            }

            authSubmit.disabled = true;
            const originalText = authSubmit.textContent;
            authSubmit.textContent = mode === "signin" ? "Signing in..." : "Creating...";

            try {
              if (mode === "signin") {
                const { data, error } = await supabase.auth.signInWithPassword({ email: emailVal, password: passwordVal });

                if (error) {
                  authMsg.textContent = humanErr(error);
                  authSubmit.disabled = false;
                  authSubmit.textContent = originalText;
                  return;
                }

                if (!data || !data.user) {
                  authMsg.textContent = "Sign in failed.";
                  authSubmit.disabled = false;
                  authSubmit.textContent = originalText;
                  return;
                }

                const isPremium = await fetchPremiumStatus(data.user.id);
                setSignedInUI(emailVal, isPremium);
                closeModal(authModal);
                window.location.href = isPremium ? PREMIUM_DASHBOARD : FREE_ACCOUNT_PAGE;
                return;
              }

              // SIGN UP
              const { error } = await supabase.auth.signUp({ email: emailVal, password: passwordVal });

              if (error) {
                authMsg.textContent = humanErr(error);
                authSubmit.disabled = false;
                authSubmit.textContent = originalText;
                return;
              }

              authMsg.textContent = "Account created! Check your email to confirm, then sign in.";
              authSubmit.disabled = false;
              authSubmit.textContent = originalText;
            } catch (err) {
              authMsg.textContent = "Error: " + (err.message || String(err));
              authSubmit.disabled = false;
              authSubmit.textContent = originalText;
            }
          });

          signout.addEventListener("click", async (e)=>{
            e.preventDefault();
            await supabase.auth.signOut();
            setSignedOutUI();
          });

          // On page load: check session
          supabase.auth.getUser().then(async ({ data: { user } }) => {
            if(user){
              const isPremium = await fetchPremiumStatus(user.id);
              setSignedInUI(user.email, isPremium);
            } else {
              setSignedOutUI();
            }
          });

        } else if(attempts === 1) {
          // Show sign-in button immediately while Supabase loads — better than blank
          openAuth.style.display = "";
        }

        if (attempts >= 100) {
          clearInterval(check);
          setSignedOutUI();
        }
      }, 100);

      window.addEventListener("keydown",(e)=>{
        if(e.key === "Escape"){
          closeModal(authModal);
          closeModal(premiumModal);
        }
      });

    })();
  </script>
</body>
</html>
